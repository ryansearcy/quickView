<!doctype=html>
    <script type='text/javascript'>
        function fetchUpdates() {
            fetch("/playback-data").then((response) => response.json()).then((result) => {
                var spotify_data = JSON.parse(JSON.stringify(result))
                if (!spotify_data["is_playing"]) {
                    window.location.replace("/realtime-transit")
                }
                if (spotify_data["name"] != document.getElementById('song_title').innerHTML) {
                    document.getElementById('song_title').className = 'title'
                    document.getElementById('artists').className = 'artist'
                    document.getElementById('song_title').innerHTML = spotify_data["name"]
                    document.getElementById('cover_art').setAttribute("src", spotify_data["cover_art"])
                    document.getElementById('artists').innerHTML = spotify_data["artists"]
                    if (document.getElementById('song_title').clientWidth < document.getElementById('song_title').scrollWidth) {
                        document.getElementById('song_title').className = 'scroll_title'
                    }
                    if (document.getElementById('artists').clientWidth < document.getElementById('artists').scrollWidth) {
                        document.getElementById('artists').className = 'scroll_artist'
                    }
                }
            });
        }
        function checkWidth() {
            if (document.getElementById('song_title').clientWidth < document.getElementById('song_title').scrollWidth) {
                document.getElementById('song_title').className = 'scroll_title'
            }
            if (document.getElementById('artists').clientWidth < document.getElementById('artists').scrollWidth) {
                document.getElementById('artists').className = 'scroll_artist'
            }
        }
        window.addEventListener("load", myInit, true); function myInit() {
            checkWidth();
            setInterval(fetchUpdates, 1000);
        }
    </script>
    <style>
        body {
            background-color: black;
            margin: 0;
        }

        .covers {
            width: 100vw;
            height: 65vh;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin-top: 5vh;
        }

        .column {
            width: 100vw;
            height: 25vh;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .title_text {
            width: 100vw;
            white-space: nowrap;
            overflow: hidden;
            box-sizing: border-box;
            position: relative;
            margin-top: 5vh;
            margin-right: 1vw;
            color: white;
        }

        .scroll_title {
            display: inline-block;
            animation: scroll-rtl 20s linear infinite;
            position: relative;
            padding-inline: 1rem;
            font-size: 8vmin;
            margin: 0;
        }

        .title {
            font-size: 8vmin;
            text-align: center;
            width: 100vw;
            margin: 0;
        }

        .artist_text {
            width: 100vw;
            white-space: nowrap;
            overflow: hidden;
            box-sizing: border-box;
            position: relative;
            margin-top: 1vh;
            margin-right: 1vw;
            color: white;
        }

        .scroll_artist {
            display: inline-block;
            animation: scroll-rtl 20s linear infinite;
            position: relative;
            padding-inline: 1rem;
            font-size: 5vmin;
            font-style: italic;
            margin: 0;
        }

        .artist {
            text-align: center;
            width: 100vw;
            font-size: 5vmin;
            font-style: italic;
            margin: 0;
        }

        @keyframes scroll-rtl {
            20% {
                transform: translate(0, 0);
                left: 0%;
            }

            80%,
            100% {
                transform: translate(-100%, 0);
                left: 100%;
            }
        }

        #cover_art {
            height: 100%;
            width: 100%;
            object-fit: contain;
        }
    </style>

    <body>
        <div class="covers" id="art"><img id='cover_art' src={{ cover_art }} alt="cover art"></div>
        <div class="column" id="titles">
            <div class="title_text">
                <p id='song_title' class="title">{{ title }}</p>
            </div>
            <div class="artist_text">
                <p id='artists' class="artist">{{ artists }}</p>
            </div>
        </div>
    </body>