<!doctype=html>
	<script type='text/javascript'>
		function fetchUpdates() {
			fetch("/playback-data").then((response) => response.json()).then((result) => {
				spotify_data = JSON.parse(JSON.stringify(result));
				if (spotify_data["status_code"] == 204 || (spotify_data["status_code"] == 200 && !spotify_data["is_playing"])) {
					fetch("/transit-times").then((response) => response.json()).then((result) => {
						time_data = JSON.parse(JSON.stringify(result));
						for (var type in time_data) {
							for (var line in time_data[type]) {
								for (var stop in time_data[type][line]) {
									document.getElementById(line + '-' + stop).innerHTML = time_data[type][line][stop];
								}
							}
						}
					})
				}
				else {
					window.location.replace("/spotify")
				}
			});
		}
		window.onload = setInterval(fetchUpdates, 10000)
	</script>
	<style>
		body {
			background-color: black;
		}

		.logo {
			display: flex;
			float: left;
			width: 15vw;
			height: {{(100/(times['Subway']|length + times['Bus']|length))-2}}vh;
			justify-content: center;
			flex-direction: column;
			margin-top: 1vh;
			margin-left: 5vw;
		}

		.box {
			display: flex;
			align-self: center;
			height: {{(100/(times['Subway']|length + times['Bus']|length))-5}}vmin;
			width: {{(100/(times['Subway']|length + times['Bus']|length))-5}}vmin;
			border-radius: 50%;
			background-color: #11117D;
			justify-content: center;
			align-items: center;
		}

		.text {
			display: flex;
			float: left;
			width: 75vw;
			height: {{(100/(times['Subway']|length + times['Bus']|length))-2}}vh;
			color: white;
			justify-content: center;
			align-items: center;
			flex-direction: column;
			margin-top: 1vh;
		}

		.bus_lines {
			display: flex;
			float: left;
			width: 15vw;
			height: {{(100/(times['Subway']|length + times['Bus']|length))-2}}vh;
			color: white;
			justify-content: center;
			align-items: center;
			flex-direction: column;
			margin-top: 1vh;
			margin-left: 5vw;
		}

		.row:after {
			display: table;
			clear: both;
			padding: 1vh;
		}

		.line_name {
			font-weight: bold;
			font-size: 10vmin;
			background-color: #11117D;
			padding-left: 1vw;
			padding-right: 1vw;
			margin: 0;

		}

		.subway_logo {
			font-size: 14vmin;
			font-family: sans-serif;
			color: white;
			margin: 0;
			text-align: center;
			font-weight: bold;
		}

		.times {
			padding-left: 1vw;
			font-size: 6vmin;
			margin: 0;
			text-align: center;
			vertical-align: middle;
		}
	</style>

	<body>
		<div class="row">
			{% for line in times['Subway'] %}
			<div class="logo">
				<div class="box">
					<p class='subway_logo'>{{ line }}</p>
				</div>
			</div>
			{% for stop in times['Subway'][line] %}
			{% set split_times = times['Subway'][line][stop].split("<br>") %}
			<div class="text">
				<p class='times' id='{{line}}-{{stop}}'>{% if split_times[1]|length == 0 %}No Departure
					Times Available
					{% else %}{{ split_times[0] }}<br>{{ split_times[1] }}{% endif %}</p>
			</div>
			{% endfor %}
			{% endfor %}
			{% for line in times['Bus'] %}
			<div class="bus_lines">
				<p class='line_name'>{{line}}</p>
			</div>
			{% for stop in times['Bus'][line] %}
			{% set split_times = times['Bus'][line][stop].split("<br>") %}
			<div class="text">
				<p class='times' id='{{line}}-{{stop}}'>{% if split_times[1]|length == 0 %}No Departure
					Times Available
					{% else %}{{ split_times[0] }}<br>{{ split_times[1] }}{% endif %}</p>
			</div>
			{% endfor %}
			{% endfor %}
		</div>
	</body>